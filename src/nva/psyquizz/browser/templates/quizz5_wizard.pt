<form action="." tal:attributes="action view.action_url;
                                 id view.htmlId();
                                 method view.formMethod;
                                 enctype view.enctype">
  <h1 tal:condition="view.label"
      tal:content="view.label">Label</h1>

  <p tal:condition="view.description"
     tal:content="view.description">Description</p>

  <p class="form-status"
     tal:condition="view.status"
     tal:content="view.status">Status</p>

  <div class="form-error"
       tal:condition="view.errors">
    <ul tal:condition="view.formErrors"
        tal:repeat="error view.formErrors">
      <li> <span tal:replace="error.title" /> </li>
    </ul>
  </div>

  <div id="global-error" class="alert alert-danger">
    <p>Bitte füllen Sie alle Felder.</p>
  </div>

  <script type="text/javascript">
   $(document).ready(function() {
       var max = <tal:max replace="len(view.get_scales()) + 1" />;
       var previous = $('#previous');
       var next = $('#next');
       var progressbar = $('.progress .progress-bar');

       jQuery('div#global-error').hide()
       next.click(function(e) {
	   var hash = window.location.hash.substring(1) || '0';
	   var current = parseInt(hash);
           $('#scale-' + current.toString() + ' .question').each(function() {
             jQuery(this).removeClass('error alert alert-danger has-error')
             jQuery('div#global-error').hide()
           }
           )
           if (current != 0) {
               $('#scale-' + current.toString() + ' .question').each(function() {
                   jQuery(this).each(function() {
                       if( !jQuery(this).find('input').is(':checked') ){
                           e.preventDefault();
                           jQuery(this).addClass('error alert alert-danger has-error');
                           console.log(this);
                           jQuery('div#global-error').show()
                       }
                   })
               })
           }
       });

       function switch_question() {

           var hash = window.location.hash.substring(1) || '0';
	   var current = parseInt(hash);

           progressbar.css(
               'width', Math.round((current / max) * 100).toString() + '%'
           ).attr('aria-valuenow', current);

           $('.scale').hide();
           $('#scale-' + hash).show();
           if (current <= 0) {
	       previous.hide();
	   }
	   else {
	       previous.show();
	       previous.attr('href', '#' + (current - 1).toString());
	   }
	   if (current < max) {
	       next.show();
	       next.attr('href', '#' + (current + 1).toString());
	   }
	   else {
	       next.hide()
	   }
       }
       window.onhashchange = switch_question
       switch_question();
   });
  </script>

  <div id="wizard">
    <div class="scale" id="scale-0">
      <p tal:content="structure context.session.about or 'Press next to start'" />
    </div>
    <div tal:repeat="scale view.get_scales()" class="scale"
         tal:attributes="id 'scale-%s' % repeat['scale'].number">
    <h1> <span tal:content="scale['label']"></span></h1>

    <div class="progress">
      <div class="progress-bar progress-bar-success" role="progressbar"
           aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
           style="width: 0%;">
      </div>
    </div>

    <br> <br>

    <div tal:repeat="widget view.getFieldWidgets(scale)" class="question" tal:attributes="id 'question-%s' % repeat['widget'].number">

      <!--
      <tal:frage condition="repeat['widget'].number > view.nbcriterias">
	     <h3>Frage: <span tal:replace="widget.title" /> / <span tal:replace="len(view.fieldWidgets) - view.nbcriterias" /></h3>
      </tal:frage>

      <tal:criteria condition="repeat['widget'].number <= view.nbcriterias">
      <h3>Frage: <span tal:content="widget.title"/> / <span tal:replace="len(view.fieldWidgets) - view.nbcriterias" /></h3>
      </tal:criteria>
      -->


      <blockquote tal:condition="widget.title in view.titles">
	      <span tal:replace="view.titles[widget.title]" />
      </blockquote>

      <tal:description tal:condition="widget.description">
	     <span class="field-description lead" tal:content="structure widget.description"> </span><br />
      </tal:description>

      <tal:error tal:define="error widget.error" tal:condition="error">
          <span class="field-error" tal:content="error.title"> Error </span> <br />
      </tal:error>
      <tal:widget tal:content="structure widget.render()" />
    </div>
    </div>

    </div>
       <div class="btn-group" role="group">
           <a id="previous" class="control btn btn-default" href="">← Zurück</a>
           <a id="next" class="control btn btn-primary" href="">Weiter →</a>
       </div>
       <div class="scale" tal:attributes="id 'scale-%d' % (len(view.get_scales()) + 1)">
         <p class="lead"> Klicken Sie auf „Abschließen“ um Ihre Daten abzusenden. </p>
         <div class="action" tal:repeat="widget view.actionWidgets">
           <tal:widget tal:content="structure widget.render()" />
        </div>
    </div>
</form>
