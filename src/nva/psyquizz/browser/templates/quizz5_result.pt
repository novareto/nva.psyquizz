<style>
#percentage-averages {
   margin-left: 25px;
}

.bar {
    border: 1px solid black;
    display: flex;
    flex-direction: row;
    width: 700px;
}

.bar > div {
   height: 30px;
   font-weight: bold;
   font-size: 1.3em;
   padding-left: 0.5em;
   color: white;
   vertical-align: middle;
   line-height: 30px;
}

.bar .mask {
  background-color: black;
  opacity: 0.2;
  }

.chart {
  height: 100px;
}

.highcharts-figure,
.highcharts-data-table table {
    min-width: 320px;
    max-width: 800px;
    margin: 1em auto;
}
</style>


<div>
  <div class="header">
    <h1>Ergebnisse</h1>
    <p>
      Hier sehen Sie die Auswertung für alle Beschäftigten.
    </p>
    <p>
      Durch Auswahl einer oder mehrerer Auswertungsgruppen haben Sie die
      Möglichkeit sich eine detaillierte Auswertung anzeigen zu lassen.
      (Bitte beachten Sie: Einzelne Auswertungsgruppen können erst ausgewählt
      werden, wenn für diese Auswertungsgruppe mindestens sieben ausgefüllte
      Fragebögen vorliegen.)
    </p>
    <p>
      Der weitere Umgang mit den Ergebnissen ist in der
      „Übersicht 7 Schritte“ unter 4. Lösungsworkshops beschrieben.
    </p>
  </div>
  <form action="." tal:attributes="action view.request.url"
        tal:define="current view.stats.filters.get('criterias', {})">
    <div>
      <a name="uncheckall">Alle</a>
    </div>
    <dl tal:define="crits view.stats.statistics['criterias']">
      <tal:dl tal:repeat="crit crits">
        <dt><h3 tal:content="crit" /></dt>
        <dd>
          <div tal:repeat="opt crits[crit]"
               style="display: inline-block; padding: 5px;">
            <tal:disabled define="disabled bool(opt.amount &lt; 7)">
              <input name="criterias" type="checkbox"
                     tal:attributes="value opt.uid;
                                     checked opt.uid in current;
                                     disabled disabled and 'disabled' or None" />
              <span tal:content="'%s (%s)' % (opt.name, opt.amount)"
                    tal:attributes="class disabled and 'text-muted' or ''"/>
            </tal:disabled>
          </div>
        </dd>
      </tal:dl>
    </dl>
    <input id="form-action-filter" type="submit" value="filter" />
  </form>

  <h1> TEST </h1>
  <span tal:content="view.stats.statistics['global.averages']"/>


  <script>
    Highcharts.setOptions({
        chart: {
            inverted: true,
            marginLeft: 135,
            type: 'bullet'
        },
        title: {
            text: null
        },
        legend: {
            enabled: false
        },
        yAxis: {
            gridLineWidth: 0
        },
        plotOptions: {
            series: {
                borderWidth: 0,
                color: '#000',
                targetOptions: {
                    width: 20,
                    height: 20,
                    borderRadius: 20,
                }
            }
        },
        credits: {
            enabled: false
        },
        exporting: {
            enabled: false
        },
        tooltip: {
            pointFormat: '<b>{point.y}</b> (with target at {point.target})'
        }
        });
  </script>

  <div tal:repeat="scale view.stats.statistics['global.averages']">
    <span tal:define="color view.colors[scale.title]"> 
       ${color} ${color[0][0]} - ${color[1][0]} - ${color[1][1]}
    </span>
    </div>
  <tal:containers
      repeat="idx range(0, len(view.stats.statistics['global.averages']))">
    <div tal:attributes="id 'container'+str(idx)" class="chart"></div>
  </tal:containers>

  <script>
    <tal:charts repeat="scale view.stats.statistics['global.averages']">
      <tal:chart define="color view.colors[scale.title]">
    var myChart = Highcharts.chart('container${repeat["scale"].index}', {
        title: null,
        xAxis: {
            categories: [
                '<span class="hc-cat-title">${scale.title}</span>'
            ]
        },
        yAxis: {
            max: 5,
            gridLineWidth: 0,
            tickInterval: 1,
            labels: {
                enabled: true,
                step: 1,
            },
            plotBands: [
            {
                from: 0,
                to: ${color[0][0]},
                color: '${color[0][1]}'
            }, {
                from: ${color[0][0]},
                to: ${color[1][0]},
                color: '${color[1][1]}'
            }, {
                from: ${color[1][0]},
                to: 5,
                color: '${color[2][1]}'
            }],
            title: null
        },
        series: [{
            data: [{
                target: ${scale.average}
            }]
        }]
    });
      </tal:chart>
    </tal:charts>
  </script>

</div>
